<!DOCTYPE html>
<html>

<body>
  <a-scene ar>
    <a id="ar-link" href="Aboutdamntime.usdz" rel="ar">
        <img src="aboutdamntime.png">
    </a>
  </a-scene>
    
    <script>
export const openIOSARQuickLook = (() => {
  const anchor = document.createElement('a');
  anchor.setAttribute('rel', 'ar');
  anchor.appendChild(document.createElement('img'));

  return (usdzSrc: string, arScale: string) => {
    const modelUrl = new URL(usdzSrc);
    if (arScale === 'fixed') {
      modelUrl.hash = 'allowsContentScaling=0';
    }
    anchor.setAttribute('href', modelUrl.toString());
    anchor.click();
  };
})();

/**
 * Takes a URL and a title string, and attempts to launch Scene Viewer on the
 * current device.
 */
export const openSceneViewer = (() => {
  const anchor = document.createElement('a');
  const noArViewerSigil = '#model-viewer-no-ar-fallback';
  let fallbackInvoked = false;

  return (gltfSrc: string, title: string, arScale: string) => {
    // If the fallback has ever been invoked this session, bounce early:
    if (fallbackInvoked) {
      return;
    }

    const location = self.location.toString();
    const locationUrl = new URL(location);
    const modelUrl = new URL(gltfSrc);
    const scheme = modelUrl.protocol.replace(':', '');

    locationUrl.hash = noArViewerSigil;

    let intentParams =
        `?file=${encodeURIComponent(modelUrl.toString())}&mode=ar_only&link=${
            location}&title=${encodeURIComponent(title)}`;

    if (arScale === 'fixed') {
      intentParams += `&resizable=false`;
    }

    const intent = `intent://arvr.google.com/scene-viewer/1.0${
        intentParams}#Intent;scheme=${
        scheme};package=com.google.ar.core;action=android.intent.action.VIEW;S.browser_fallback_url=${
        encodeURIComponent(locationUrl.toString())};end;`;

    const undoHashChange = () => {
      if (self.location.hash === noArViewerSigil && !fallbackInvoked) {
        fallbackInvoked = true;
        // The new history will be the current URL with a new hash.
        // Go back one step so that we reset to the expected URL.
        // NOTE(cdata): this should not invoke any browser-level navigation
        // because hash-only changes modify the URL in-place without
        // navigating:
        self.history.back();
      }
    };

    self.addEventListener('hashchange', undoHashChange, {once: true});

    anchor.setAttribute('href', intent);
    anchor.click();
  };
})();
                            
                                                          
                                                          
    </script>
    
    
    
    
</body>
</html>

